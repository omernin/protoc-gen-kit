# protoc-gen-kit

This is a fork of protoc-gen-micro. Inspired by go-micro we are using code generation to reduce go-kit boilerplate code.
In addition, we are generating grpc-gateway code that integrates with go-kit.

## Install

```bash
go get github.com/omernin/protoc-gen-kit
```

Also required:

- [protoc](https://github.com/google/protobuf)
- [protoc-gen-go](https://github.com/golang/protobuf)
- [go-kit](github.com/go-kit/kit)
- [oklog](github.com/oklog/oklog)
- [prometheus-client](github.com/prometheus/client_golang)
- [gRpc](google.golang.org/grpc)
- [gRpc gateway](https://github.com/grpc-ecosystem/grpc-gateway)
- [docker-protoc](https://github.com/namely/docker-protoc)

## Usage

Define your service as `greeter.proto`

```proto
syntax = "proto3";

package greetergrpc;

import "google/api/annotations.proto";

option go_package = "github.com/omernin/protoc-gen-kit/v1";

service Greeter {
	rpc Hello(HelloRequest) returns (HelloResponse) {
		option (google.api.http) = {
			get: "/api/v1/hello"
		  };
	}
	rpc Goodbye(GoodbyeRequest) returns (GoodbyeResponse) {
		option (google.api.http) = {
			get: "/goodbye"
		  };
	}
}

message HelloRequest {
	string name = 1;
}

message HelloResponse {
	string msg = 1;
}

message GoodbyeRequest {
	string name = 1;
}

message GoodbyeResponse {
	string msg = 1;
}

```

Generate the code

```bash
protoc --proto_path=$GOPATH/src:. --kit_out=. --go_out=plugins=grpc:. greeter.proto
```

Your output result should be:

```bash
./
    greeter.proto   # original protobuf file
    greeter.pb.go   # auto-generated by protoc-gen-go
    greeter.kit.go  # auto-generated by protoc-gen-kit
```

The kit generated code includes grpc transport, service endpoint and common middleware.

### Errors

If you see an error about `protoc-gen-kit` not being found or executable, it's likely your environment may not be configured correctly. If you've already installed `protoc`, `protoc-gen-go`, and `protoc-gen-kit` ensure you've included `$GOPATH/bin` in your `PATH`.

Alternative specify the Go plugin paths as arguments to the `protoc` command

```bash
protoc --plugin=protoc-gen-go=$GOPATH/bin/protoc-gen-go --plugin=protoc-gen-kit=$GOPATH/bin/protoc-gen-kit --proto_path=$GOPATH/src:. --micro_out=. --go_out=. greeter.proto
```

### Run via docker

In order to wrap the code generation code with a docker image, we use the `namely/protoc-all` image as a base image and add our protoc plugin + change the docker image entrypoint.sh file so we can generate go-kit code.

The final image can be pulled via the image name: `omernin/protoc-all-with-kit`

you can generate code via docker by running the following command:

```bash
docker run -v $(pwd):/defs/ omernin/protoc-all-with-kit -l go -f greeter.proto --with-gateway --with-validator --with-openapi-json-names --with-kit
```

for more information regarding `namely/protoc-all` please check the git repo at: https://github.com/namely/docker-protoc

## LICENSE

protoc-gen-kit is a liberal reuse of protoc-gen-go hence we maintain the original license
